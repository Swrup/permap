let f request =
% begin match Dream.session "nick" request with
% | None ->
% let redirect = Dream.to_percent_encoded "/new_thread" in
  <a href="/login?redirect=<%s redirect%>">Login</a> to make a new thread.
% | Some _nick ->
  <script type="text/javascript" src="/assets/js/js_newthread.js" defer="defer"></script>
  <h1>New thread</h1>
  <div id="newthread">
      Click the map to make a new thread:
  </div>
  <br />
  <div class="row mb-3">
    <div class="col-md-6">
      <div id="map"></div>
      <br />
        <button class="btn btn-primary" id="geolocalize">Geolocalize me</button>
        <br />
        <br />
    </div>
    <div class="col-md-6" id="newthread-form">
      <div class="postForm">
<%s! Dream.form_tag ~action:"/new_thread" ~enctype:`Multipart_form_data request %>
          <input type="hidden" id="lat-input" name="lat-input">
          <input type="hidden" id="lng-input" name="lng-input">

          <label for="subject" id="subject-label" class="form-label">Subject</label>
          <input name="subject" type="text" class="form-control" id="subject" aria-labelledby="subject-label"></input>
          <br />
          <label for="thread-comment" id="thread-comment-label" class="form-label">Comment</label>
          <textarea name="thread-comment" type="text" class="form-control" id="thread-comment" aria-labelledby="thread-comment-label"></textarea>
          <br />
          <label for="tags" id="tags-label" class="form-label">Tags</label>
          <input name="tags" type="text" class="form-control" id="tags" aria-labelledby="tags-label"></input>
          <br />
          <label for="file" id="file-label" class="form-label">Picture:</label>
          <input id="file" name="file" aria-describedby="file-label" type="file" accept="image/*">
          <br />
          <label for="alt" id="alt-label" class="form-label">Image description:</label>
          <input name="alt" type="text" class="form-control" id="alt" aria-labelledby="alt-label"></input>
          <br />
          <button type="submit" class="btn btn-primary">Make Thread</button>
        </form>
      </div>
    </div>
  </div>
% end;
